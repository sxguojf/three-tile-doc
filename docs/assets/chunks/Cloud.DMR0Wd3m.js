import{d as T,p as m,q as S,v as A,x as R,c as P,o as F,j as o,F as I,B as N,a as V,a4 as h,t as u,a8 as z,a9 as O,aa as U,k as d,_ as j}from"./framework.xbTv8SNN.js";import{y as q,ao as G,ap as H,a0 as b,T as k,aq as W,e as f,ai as X,ar as D,al as Y,C as $,as as J}from"./index.CqI7X3xo.js";import{u as K,a as Q,b as Z}from"./style.Ddmk4huO.js";class ee extends q{constructor(t,s){const r=new G(1,1,t,s);super(r),this.material=this._createMaterial()}get displacementScale(){return this.material.displacementScale}set displacementScale(t){this.material.displacementScale=t}get displacementBias(){return this.material.displacementBias}set displacementBias(t){this.material.displacementBias=t}_createMaterial(){const t=new H({map:new b,aoMap:new b,displacementMap:new b,transparent:!0,displacementScale:.5,displacementBias:0});return t.onBeforeCompile=s=>{s.vertexShader=`uniform sampler2D map;
        `+s.vertexShader,s.vertexShader=s.vertexShader.replace("#include <displacementmap_vertex>",`#include <displacementmap_vertex> 

                #ifdef USE_MAP
                    transformed += normalize( objectNormal) * (texture2D(map, vMapUv).a * displacementScale + displacementBias );
                #endif
                `),s.fragmentShader=s.fragmentShader.replace("#include <alphamap_fragment>",`#include <alphamap_fragment>
                
                #if defined(USE_AOMAP) && defined(USE_MAP)
                    float h = texture2D(map, vMapUv).a;
                    // h = round(h*8.0)/8.0;
                    diffuseColor *= texture2D(aoMap, vec2(h-(20.0/255.0),0.0));
                    diffuseColor.a = clamp(h*1.5, 0.0, 1.0);
                #endif
                `)},this.setPalttle(1),t}async load(t){var r;const s=await new k().loadAsync(t);return(r=this.material.map)==null||r.dispose(),this.material.map=s,s}async setPalttle(t){var v;const s=new k;s.setPath("../../pal/");const r=typeof t=="number"?`pal0${t}.png`:t,_=await s.loadAsync(r);return(v=this.material.aoMap)==null||v.dispose(),this.material.aoMap=_,this}dispose(){var t,s;this.removeFromParent(),this.geometry.dispose(),(t=this.material.aoMap)==null||t.dispose(),(s=this.material.map)==null||s.dispose(),this.material.dispose()}}const ae={class:"demo-container"},te={class:"tools"},se=["value"],oe={for:"wireframe"},ne={class:"scale"},le={class:"scale"},re={class:"state"},ie={class:"location"},de={class:"loading"},ce=T({__name:"Cloud",setup(E){const t=()=>{const e=X.create({imgSource:[new D({style:"6"}),new D({style:"8"})],lon0:90,bounds:[60,0,145,60]});return e.rotateX(-Math.PI/2),e.addEventListener("tile-loaded",a=>{a.tile.model.material.forEach(n=>{"color"in n&&n.color.set(11184810)})}),e},s=()=>{const e=new Y;return e.scene.background=new $(3355443),e.scene.fog=null,e.dirLight.intensity=2,e.renderer.toneMapping=J,e.controls.zoomToCursor=!0,e},r=(e,a)=>{a.controls.maxDistance=5e6;const n=e.geo2world(new f(e.bounds[0],e.bounds[3])),p=e.geo2world(new f(e.bounds[2],e.bounds[1])),y=new f;a.controls.addEventListener("change",function(){y.copy(a.controls.target),a.controls.target.clamp(n,p),y.sub(a.controls.target),a.camera.position.sub(y)})},_=(e,a,n,p)=>{e.controls.target.copy(a.geo2world(n)),e.camera.position.copy(a.geo2world(p))},v=()=>{const e=new ee(529,420);return e.scale.set(8e6,7e6,2e5),e.position.set(15e5,4e6,1e3),e.renderOrder=999,e},i=t(),c=s(),l=v(),g=m(null),B=m();K(c.controls,B);const w=Q(i,c),L=Z(i),C=m("");S(C,async e=>{await l.load(e)});const x=m(1);S(x,e=>{l.setPalttle(e)});const M=m(!1);return S(M,e=>{l.material.wireframe=e}),A(()=>{if(!g.value){console.error("Viewer container is null");return}c.addTo(g.value),c.scene.add(i),i.add(l),i.add(new W(l,16711680)),r(i,c),_(c,i,new f(105,35,0),new f(105,25,3e6)),C.value="../../cloud/SATE_L1_F2G_VISSR_MWB_NOM_FDI-202107241900.HDF.png"}),R(()=>{l.dispose(),i.dispose()}),(e,a)=>(F(),P("div",ae,[o("div",{ref_key:"viewerRef",ref:g,class:"map-container"},null,512),o("div",te,[(F(),P(I,null,N([1,2,3,4,5],n=>o("label",{key:n},[V(" 调色板 "+u(n)+" ",1),h(o("input",{type:"radio",value:n,"onUpdate:modelValue":a[0]||(a[0]=p=>x.value=p)},null,8,se),[[z,x.value]])])),64)),o("label",oe,[a[4]||(a[4]=V(" 显示线框 ")),h(o("input",{type:"checkbox",name:"wireframe",id:"wireframe","onUpdate:modelValue":a[1]||(a[1]=n=>M.value=n)},null,512),[[O,M.value]])]),o("div",ne,[a[5]||(a[5]=o("label",{for:"scale"},"夸张",-1)),h(o("input",{type:"range",id:"scale",min:"0.1",max:"2",step:"0.1",class:"scale","onUpdate:modelValue":a[2]||(a[2]=n=>d(l).displacementScale=n)},null,512),[[U,d(l).displacementScale]])]),o("div",le,[a[6]||(a[6]=o("label",{for:"bias"},"抬升",-1)),h(o("input",{type:"range",id:"bias",min:"0",max:"2",step:"0.1",class:"scale","onUpdate:modelValue":a[3]||(a[3]=n=>d(l).displacementBias=n)},null,512),[[U,d(l).displacementBias]])])]),o("div",{class:"compass",ref_key:"compassRef",ref:B},null,512),o("div",re,[o("div",ie,[o("span",null,"经度："+u(d(w).x.toFixed(6))+"° ",1),o("span",null,"纬度："+u(d(w).y.toFixed(6))+"° ",1),o("span",null,"海拔："+u(d(w).z.toFixed(1))+"m ",1)]),o("div",de,u(d(L)),1)])]))}}),fe=j(ce,[["__scopeId","data-v-61c72584"]]);export{fe as default};
