var I=Object.defineProperty;var V=(f,n,i)=>n in f?I(f,n,{enumerable:!0,configurable:!0,writable:!0,value:i}):f[n]=i;var L=(f,n,i)=>V(f,typeof n!="symbol"?n+"":n,i);import{d as A,p as $,v as H,x as N,c as B,o as q,j as r,a as k,k as a,a4 as U,a9 as G,aa as J,t as E,_ as X}from"./framework.BQo5SrHh.js";import{m as R,V as S,O as Y,i as W,S as Z,b as O,aE as K,aF as Q,al as j,ay as tt,aB as et,ai as nt,aj as ot,ak as rt,aG as st,am as T}from"./index.B0Mz6VAy.js";import{a as it,b as lt,u as at}from"./style.B3RjSc2H.js";import{u as dt}from"./useSky.ByY0yeG8.js";import{u as ut}from"./useFog.nsXJc4ko.js";class ct extends Y{constructor(n=document.createElement("div")){super(),this.isCSS2DObject=!0,this.element=n,this.element.style.position="absolute",this.element.style.userSelect="none",this.element.setAttribute("draggable",!1),this.center=new W(.5,.5),this.addEventListener("removed",function(){this.traverse(function(i){i.element instanceof i.element.ownerDocument.defaultView.Element&&i.element.parentNode!==null&&i.element.remove()})})}copy(n,i){return super.copy(n,i),this.element=n.element.cloneNode(!0),this.center=n.center,this}}const b=new S,_=new R,P=new R,z=new S,D=new S;class ft{constructor(n={}){const i=this;let v,h,C,g;const x={objects:new WeakMap},m=n.element!==void 0?n.element:document.createElement("div");m.style.overflow="hidden",this.domElement=m,this.getSize=function(){return{width:v,height:h}},this.render=function(e,t){e.matrixWorldAutoUpdate===!0&&e.updateMatrixWorld(),t.parent===null&&t.matrixWorldAutoUpdate===!0&&t.updateMatrixWorld(),_.copy(t.matrixWorldInverse),P.multiplyMatrices(t.projectionMatrix,_),d(e,e,t),w(e)},this.setSize=function(e,t){v=e,h=t,C=v/2,g=h/2,m.style.width=e+"px",m.style.height=t+"px"};function c(e){e.isCSS2DObject&&(e.element.style.display="none");for(let t=0,o=e.children.length;t<o;t++)c(e.children[t])}function d(e,t,o){if(e.visible===!1){c(e);return}if(e.isCSS2DObject){b.setFromMatrixPosition(e.matrixWorld),b.applyMatrix4(P);const s=b.z>=-1&&b.z<=1&&e.layers.test(o.layers)===!0,l=e.element;l.style.display=s===!0?"":"none",s===!0&&(e.onBeforeRender(i,t,o),l.style.transform="translate("+-100*e.center.x+"%,"+-100*e.center.y+"%)translate("+(b.x*C+C)+"px,"+(-b.y*g+g)+"px)",l.parentNode!==m&&m.appendChild(l),e.onAfterRender(i,t,o));const u={distanceToCameraSquared:y(o,e)};x.objects.set(e,u)}for(let s=0,l=e.children.length;s<l;s++)d(e.children[s],t,o)}function y(e,t){return z.setFromMatrixPosition(e.matrixWorld),D.setFromMatrixPosition(t.matrixWorld),z.distanceToSquared(D)}function F(e){const t=[];return e.traverseVisible(function(o){o.isCSS2DObject&&t.push(o)}),t}function w(e){const t=F(e).sort(function(s,l){if(s.renderOrder!==l.renderOrder)return l.renderOrder-s.renderOrder;const u=x.objects.get(s).distanceToCameraSquared,p=x.objects.get(l).distanceToCameraSquared;return u-p}),o=t.length;for(let s=0,l=t.length;s<l;s++)t[s].element.style.zIndex=o-s}}}class mt extends Z{constructor(n){super({name:"EleatorShader",uniforms:{contourColor:{value:new O(n==null?void 0:n.color)},contourInterval:{value:n==null?void 0:n.interval},contourWidth:{value:n==null?void 0:n.width}},vertexShader:`
                precision highp float;

                #include <common>
                #include <logdepthbuf_pars_vertex>

                varying float vHeight;

                void main() {
                    #include <begin_vertex>
                    #include <project_vertex>
                    #include <logdepthbuf_vertex>

                    vHeight = position.z;                    
                }
            `,fragmentShader:`
                precision highp float;

                #include <logdepthbuf_pars_fragment>

                uniform vec3 contourColor;
                uniform float contourInterval;
                uniform float contourWidth;
                
                varying float vHeight;

                void main() {
                    #include <logdepthbuf_fragment>

                    float contourPos = mod(vHeight, contourInterval) / contourInterval;
                    float pixelWidth = contourWidth * fwidth(contourPos);  
                    float distToEdge = min(contourPos, 1.0 - contourPos) ; 
                    float edgeFactor = smoothstep(0.0, pixelWidth, distToEdge); 
                    float alpha = smoothstep(0.0, 1.0, 1.0 - edgeFactor);
                    gl_FragColor = vec4(contourColor, alpha);
                }
            `,transparent:!1})}copy(n){return this.uniforms=n.uniforms,this}}class pt extends K{constructor(i=new O(16711680),v=100,h=1){super();L(this,"dataType","contour");this.material=new mt({interval:v,width:h,color:i})}get _uniforms(){return this.material.uniforms}set color(i){this._uniforms.contourColor.value=new O(i)}get color(){return this._uniforms.contourColor.value}set interval(i){this._uniforms.contourInterval.value=i}get interval(){return this._uniforms.contourInterval.value}set width(i){this._uniforms.contourWidth.value=i}get width(){return this._uniforms.contourWidth.value}}const vt={class:"demo-container"},ht={class:"tools"},gt={for:"fogFactor"},xt={class:"state"},bt={class:"location"},Ct={class:"loading"},yt=A({__name:"Contour",setup(f){const n=new pt(16711680,100,1);Q(n);const i=()=>{const e=nt.create({imgSource:[new rt,st.create({dataType:"contour",minLevel:10})],demSource:new ot,lon0:90,bounds:[60,0,145,60]});return e.rotateX(-Math.PI/2),e},v=(e,t)=>{const o=e.geo2map(t),s=document.createElement("div");s.className="a4-billboard",s.title=`经纬度: ${t.x.toFixed(2)}, ${t.y.toFixed(2)}`;const l=document.createElement("div");l.className="a4-height",l.textContent=`${t.z.toFixed(1)}米`,s.appendChild(l);const u=new ct(s);return u.center.set(.5,1),u.position.copy(o),e.add(u),s.addEventListener("pointerup",()=>{u.removeFromParent()}),u},h=(e,t,o)=>{const s=new ft({element:o}),l=e.renderer.domElement;e.addEventListener("update",()=>{s.render(e.scene,e.camera)}),e.addEventListener("resize",()=>{s.setSize(l.clientWidth,l.clientHeight)});const u=new W;return l.addEventListener("pointerdown",p=>{T(p,t,e.camera)&&u.set(p.x,p.y)}),l.addEventListener("pointerup",p=>{const M=T(p,t,e.camera);M&&new W(p.x,p.y).distanceTo(u)<5&&v(t,M)}),s},C=(e,t,o,s)=>(e.controls.target.copy(t.geo2world(o)),e.camera.position.copy(t.geo2world(s)),{centerPos:e.controls.target,camerePos:e.camera.position}),g=$(null),x=$(null),m=$(),c=i(),d=new j;d.renderer.toneMapping=tt;const y=it(c,d),F=lt(c),{fogFactor:w}=ut(d);return at(d.controls,m),H(()=>{if(!g.value||!x.value){console.error("map or cssrenderer or compass container is null");return}d.addTo(g.value),d.scene.add(c),h(d,c,x.value),dt(d.scene),C(d,c,new S(87,28,5e3),new S(87.03,28.03,8e3)),c.addEventListener("update",()=>{et(c,d.camera)})}),N(()=>{c.dispose()}),(e,t)=>(q(),B("div",vt,[r("div",{ref_key:"viewerRef",ref:g,class:"map-container"},null,512),r("div",{ref_key:"cssrendererRef",ref:x,class:"cssrenderer"},null,512),r("div",ht,[r("div",null,[t[16]||(t[16]=k(" 等高线颜色： ")),r("button",{class:"button",onClick:t[0]||(t[0]=o=>a(n).color=16711680)},"红色"),r("button",{class:"button",onClick:t[1]||(t[1]=o=>a(n).color=16711935)},"品红色"),r("button",{class:"button",onClick:t[2]||(t[2]=o=>a(n).color=65280)},"绿色"),r("button",{class:"button",onClick:t[3]||(t[3]=o=>a(n).color=255)},"蓝色"),r("button",{class:"button",onClick:t[4]||(t[4]=o=>a(n).color=16776960)},"黄色")]),r("div",null,[t[17]||(t[17]=k(" 等高线间隔： ")),r("button",{class:"button",onClick:t[5]||(t[5]=o=>a(n).interval=10)},"10m"),r("button",{class:"button",onClick:t[6]||(t[6]=o=>a(n).interval=50)},"50m"),r("button",{class:"button",onClick:t[7]||(t[7]=o=>a(n).interval=100)},"100m"),r("button",{class:"button",onClick:t[8]||(t[8]=o=>a(n).interval=300)},"300m"),r("button",{class:"button",onClick:t[9]||(t[9]=o=>a(n).interval=500)},"500m")]),r("div",null,[t[18]||(t[18]=k(" 等高线宽度： ")),r("button",{class:"button",onClick:t[10]||(t[10]=o=>a(n).width=1)},"1px"),r("button",{class:"button",onClick:t[11]||(t[11]=o=>a(n).width=2)},"2px"),r("button",{class:"button",onClick:t[12]||(t[12]=o=>a(n).width=3)},"3px"),r("button",{class:"button",onClick:t[13]||(t[13]=o=>a(n).width=5)},"5px"),r("button",{class:"button",onClick:t[14]||(t[14]=o=>a(n).width=0)},"0px")]),r("label",gt,[t[19]||(t[19]=k("雾浓度: ")),U(r("input",{type:"range",id:"fogFactor",min:"0",max:"5",step:"0.1","onUpdate:modelValue":t[15]||(t[15]=o=>J(w)?w.value=o:null)},null,512),[[G,a(w)]])])]),r("div",{class:"compass",ref_key:"compassRef",ref:m},null,512),r("div",xt,[r("div",bt,[r("span",null,"经度："+E(a(y).x.toFixed(6))+"° ",1),r("span",null,"纬度："+E(a(y).y.toFixed(6))+"° ",1),r("span",null,"海拔："+E(a(y).z.toFixed(1))+"m ",1)]),r("div",Ct,E(a(F)),1)])]))}}),$t=X(yt,[["__scopeId","data-v-3dafd273"]]);export{$t as default};
