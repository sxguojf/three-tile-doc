import{d as L,p,q as y,v as U,x as T,c as P,o as F,j as s,F as R,B as I,a as V,a4 as k,t as u,a8 as N,a9 as z,k as _,_ as O}from"./framework.xbTv8SNN.js";import{M as j,ao as q,ap as G,a9 as b,o as B,V as m,ai as H,aq as D,al as W,b as X,ar as Y}from"./index.xb0hfx6i.js";import{u as $,a as J,b as K}from"./style.n9PNkupe.js";class Q extends j{constructor(o,a){const r=new q(1,1,o,a);super(r),this.material=this._createMaterial()}_createMaterial(){const o=new G({map:new b,aoMap:new b,displacementMap:new b,transparent:!0,displacementScale:1,displacementBias:0});return o.onBeforeCompile=a=>{a.vertexShader=`uniform sampler2D map;
        `+a.vertexShader,a.vertexShader=a.vertexShader.replace("#include <displacementmap_vertex>",`#include <displacementmap_vertex> 

                #ifdef USE_MAP
                    transformed += normalize( objectNormal) * (texture2D(map, vMapUv).a * displacementScale + displacementBias );
                #endif
                `),a.fragmentShader=a.fragmentShader.replace("#include <alphamap_fragment>",`#include <alphamap_fragment>
                
                #if defined(USE_AOMAP) && defined(USE_MAP)
                    float h = texture2D(map, vMapUv).a;
                    // h = round(h*8.0)/8.0;
                    diffuseColor *= texture2D(aoMap, vec2(h-(20.0/255.0),0.0));
                    diffuseColor.a = clamp(h*1.5, 0.0, 1.0);
                #endif
                `)},this.setPalttle(1),o}async load(o){var r;const a=await new B().loadAsync(o);return(r=this.material.map)==null||r.dispose(),this.material.map=a,a}async setPalttle(o){var f;const a=new B;a.setPath("../../pal/");const r=typeof o=="number"?`pal0${o}.png`:o,h=await a.loadAsync(r);return(f=this.material.aoMap)==null||f.dispose(),this.material.aoMap=h,this}dispose(){var o,a;this.removeFromParent(),this.geometry.dispose(),(o=this.material.aoMap)==null||o.dispose(),(a=this.material.map)==null||a.dispose(),this.material.dispose()}}const Z={class:"demo-container"},ee={class:"tools"},ae=["value"],te={for:"wireframe"},oe={class:"state"},se={class:"location"},ne={class:"loading"},re=L({__name:"Cloud",setup(E){const o=()=>{const e=H.create({imgSource:[new D({style:"6"}),new D({style:"8"})],lon0:90,bounds:[60,0,145,60]});return e.rotateX(-Math.PI/2),e.addEventListener("tile-loaded",t=>{t.tile.model.material.forEach(n=>{"color"in n&&n.color.set(11184810)})}),e},a=()=>{const e=new W;return e.scene.background=new X(0),e.scene.fog=null,e.renderer.toneMapping=Y,e.controls.zoomToCursor=!0,e},r=(e,t)=>{t.controls.maxDistance=5e6;const n=e.geo2world(new m(e.bounds[0],e.bounds[3])),d=e.geo2world(new m(e.bounds[2],e.bounds[1])),x=new m;t.controls.addEventListener("change",function(){x.copy(t.controls.target),t.controls.target.clamp(n,d),x.sub(t.controls.target),t.camera.position.sub(x)})},h=(e,t,n,d)=>{e.controls.target.copy(t.geo2world(n)),e.camera.position.copy(t.geo2world(d))},f=()=>{const e=new Q(529,420);return e.scale.set(8e6,7e6,2e5),e.position.set(15e5,4e6,1e3),e.renderOrder=999,e},l=o(),i=a(),c=f(),v=p(null),S=p();$(i.controls,S);const w=J(l,i),A=K(l),C=p("");y(C,async e=>{await c.load(e)});const M=p(1);y(M,e=>{c.setPalttle(e)});const g=p(!1);return y(g,e=>{c.material.wireframe=e}),U(()=>{if(!v.value){console.error("Viewer container is null");return}i.addTo(v.value),i.scene.add(l),l.add(c),r(l,i),h(i,l,new m(105,35,0),new m(105,25,3e6)),C.value="../../cloud/SATE_L1_F2G_VISSR_MWB_NOM_FDI-202107241900.HDF.png"}),T(()=>{c.dispose(),l.dispose()}),(e,t)=>(F(),P("div",Z,[s("div",{ref_key:"viewerRef",ref:v,class:"map-container"},null,512),s("div",ee,[(F(),P(R,null,I([1,2,3,4,5],n=>s("label",{key:n},[V(" 调色板 "+u(n)+" ",1),k(s("input",{type:"radio",value:n,"onUpdate:modelValue":t[0]||(t[0]=d=>M.value=d)},null,8,ae),[[N,M.value]])])),64)),s("label",te,[t[2]||(t[2]=V(" 显示线框 ")),k(s("input",{type:"checkbox",name:"wireframe",id:"wireframe","onUpdate:modelValue":t[1]||(t[1]=n=>g.value=n)},null,512),[[z,g.value]])])]),s("div",{class:"compass",ref_key:"compassRef",ref:S},null,512),s("div",oe,[s("div",se,[s("span",null,"经度："+u(_(w).x.toFixed(6))+"° ",1),s("span",null,"纬度："+u(_(w).y.toFixed(6))+"° ",1),s("span",null,"海拔："+u(_(w).z.toFixed(1))+"m ",1)]),s("div",ne,u(_(A)),1)])]))}}),de=O(re,[["__scopeId","data-v-48525068"]]);export{de as default};
