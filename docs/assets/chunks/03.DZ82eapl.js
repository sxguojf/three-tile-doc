import{d as E,p as d,q as M,v as V,x as A,c as k,o as C,j as n,F as T,B as U,t as p,a4 as R,a as I,a7 as N,k as _,_ as z}from"./framework.BZ48x_LH.js";import{M as O,P as $,e as j,T as x,f as P,V as u,d as G,g as B,Y,b as q}from"./index.BXUrQien.js";import{u as H,a as W,b as X}from"./style.NnfX0RUE.js";class J extends O{constructor(o,a){const r=new $(1,1,o,a);super(r),this.material=this._createMaterial()}_createMaterial(){const o=new j({map:new x,aoMap:new x,displacementMap:new x,transparent:!0,displacementScale:1,displacementBias:0});return o.onBeforeCompile=a=>{a.vertexShader=`uniform sampler2D map;
        `+a.vertexShader,a.vertexShader=a.vertexShader.replace("#include <displacementmap_vertex>",`#include <displacementmap_vertex> 

                #ifdef USE_MAP
                    transformed += normalize( objectNormal) * (texture2D(map, vMapUv).a * displacementScale + displacementBias );
                #endif
                `),a.fragmentShader=a.fragmentShader.replace("#include <alphamap_fragment>",`#include <alphamap_fragment>
                
                #if defined(USE_AOMAP) && defined(USE_MAP)
                    float h = texture2D(map, vMapUv).a;
                    // h = round(h*8.0)/8.0;
                    diffuseColor *= texture2D(aoMap, vec2(h-(20.0/255.0),0.0));
                    diffuseColor.a = clamp(h*1.5, 0.0, 1.0);
                #endif
                `)},this.setPalttle(1),o}async load(o){var r;const a=await new P().loadAsync(o);return(r=this.material.map)==null||r.dispose(),this.material.map=a,a}async setPalttle(o){var m;const a=typeof o=="number"?`../pal/pal0${o}.png`:o,r=await new P().loadAsync(a);return(m=this.material.aoMap)==null||m.dispose(),this.material.aoMap=r,this}dispose(){var o,a;this.geometry.dispose(),(o=this.material.aoMap)==null||o.dispose(),(a=this.material.map)==null||a.dispose(),this.material.dispose()}}const K={class:"demo-container"},Q={class:"tools"},Z=["onClick"],ee={for:"wireframe"},te={class:"state"},ae={class:"location"},oe={class:"loading"},se=E({__name:"03",setup(D){const o=()=>{const e=G.create({imgSource:[new B({style:"6"}),new B({style:"8"})],lon0:90,bounds:[60,0,145,60]});return e.rotateX(-Math.PI/2),e.addEventListener("tile-loaded",t=>{t.tile.model.material.forEach(s=>{"color"in s&&s.color.set(11184810)})}),e},a=()=>{var t;const e=new Y;return e.scene.background=new q(0),(t=e.scene.fog)==null||t.color.set(e.scene.background),e.dirLight.intensity=2,e.controls.zoomToCursor=!0,e},r=(e,t)=>{t.controls.maxDistance=5e6;const s=e.geo2world(new u(e.bounds[0],e.bounds[3])),f=e.geo2world(new u(e.bounds[2],e.bounds[1])),g=new u;t.controls.addEventListener("change",function(){g.copy(t.controls.target),t.controls.target.clamp(s,f),g.sub(t.controls.target),t.camera.position.sub(g)})},m=(e,t,s,f)=>{e.controls.target.copy(t.geo2world(s)),e.camera.position.copy(t.geo2world(f))},F=()=>{const e=new J(529,420);return e.scale.set(8e6,7e6,2e5),e.position.set(15e5,4e6,1e3),e.renderOrder=999,e},l=o(),c=a(),i=F(),h=d(null),y=d();H(c.controls,y);const v=W(l,c),L=X(l),b=d("");M(b,async e=>{await i.load(e)});const S=d(1);M(S,e=>{i.setPalttle(e)});const w=d(!1);return M(w,e=>{i.material.wireframe=e}),V(()=>{if(!h.value){console.error("map or compass container is null");return}c.addTo(h.value),c.scene.add(l),l.add(i),r(l,c),m(c,l,new u(105,35,0),new u(105,25,3e6)),b.value="../cloud/SATE_L1_F2G_VISSR_MWB_NOM_FDI-202107241900.HDF.png"}),A(()=>{i.dispose(),l.dispose()}),(e,t)=>(C(),k("div",K,[n("div",{ref_key:"viewerRef",ref:h,class:"map-container"},null,512),n("div",Q,[(C(),k(T,null,U([1,2,3,4,5],s=>n("button",{type:"button",class:"button",key:s,onClick:f=>S.value=s}," 调色板"+p(`${s}`),9,Z)),64)),n("label",ee,[R(n("input",{type:"checkbox",name:"wireframe",id:"wireframe","onUpdate:modelValue":t[0]||(t[0]=s=>w.value=s)},null,512),[[N,w.value]]),t[1]||(t[1]=I("线框"))])]),n("div",{class:"compass",ref_key:"compassRef",ref:y},null,512),n("div",te,[n("div",ae,[n("span",null,"经度："+p(_(v).x.toFixed(6))+"° ",1),n("span",null,"纬度："+p(_(v).y.toFixed(6))+"° ",1),n("span",null,"海拔："+p(_(v).z.toFixed(1))+"m ",1)]),n("div",oe,p(_(L)),1)])]))}}),ce=z(se,[["__scopeId","data-v-3b6c07ae"]]);export{ce as default};
