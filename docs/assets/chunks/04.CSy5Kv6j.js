var P=Object.defineProperty;var R=(m,n,s)=>n in m?P(m,n,{enumerable:!0,configurable:!0,writable:!0,value:s}):m[n]=s;var L=(m,n,s)=>R(m,typeof n!="symbol"?n+"":n,s);import{q as I,V as S,O as V,p as W,S as H,b as _,r as N,x as q,Y as A,s as B,d as U,Z as J,J as Y,t as Z,L as O}from"./index.BXUrQien.js";import{a as X,b as G,u as K}from"./style.NnfX0RUE.js";import{u as Q}from"./useSky.CSQ3i_TO.js";import{d as j,p as $,v as tt,x as et,c as nt,o as ot,j as o,a as M,k as a,t as k,_ as st}from"./framework.BZ48x_LH.js";class rt extends V{constructor(n=document.createElement("div")){super(),this.isCSS2DObject=!0,this.element=n,this.element.style.position="absolute",this.element.style.userSelect="none",this.element.setAttribute("draggable",!1),this.center=new W(.5,.5),this.addEventListener("removed",function(){this.traverse(function(s){s.element instanceof s.element.ownerDocument.defaultView.Element&&s.element.parentNode!==null&&s.element.remove()})})}copy(n,s){return super.copy(n,s),this.element=n.element.cloneNode(!0),this.center=n.center,this}}const b=new S,F=new I,z=new I,T=new S,D=new S;class it{constructor(n={}){const s=this;let p,h,C,x;const g={objects:new WeakMap},v=n.element!==void 0?n.element:document.createElement("div");v.style.overflow="hidden",this.domElement=v,this.getSize=function(){return{width:p,height:h}},this.render=function(t,e){t.matrixWorldAutoUpdate===!0&&t.updateMatrixWorld(),e.parent===null&&e.matrixWorldAutoUpdate===!0&&e.updateMatrixWorld(),F.copy(e.matrixWorldInverse),z.multiplyMatrices(e.projectionMatrix,F),c(t,t,e),d(t)},this.setSize=function(t,e){p=t,h=e,C=p/2,x=h/2,v.style.width=t+"px",v.style.height=e+"px"};function u(t){t.isCSS2DObject&&(t.element.style.display="none");for(let e=0,i=t.children.length;e<i;e++)u(t.children[e])}function c(t,e,i){if(t.visible===!1){u(t);return}if(t.isCSS2DObject){b.setFromMatrixPosition(t.matrixWorld),b.applyMatrix4(z);const r=b.z>=-1&&b.z<=1&&t.layers.test(i.layers)===!0,l=t.element;l.style.display=r===!0?"":"none",r===!0&&(t.onBeforeRender(s,e,i),l.style.transform="translate("+-100*t.center.x+"%,"+-100*t.center.y+"%)translate("+(b.x*C+C)+"px,"+(-b.y*x+x)+"px)",l.parentNode!==v&&v.appendChild(l),t.onAfterRender(s,e,i));const f={distanceToCameraSquared:w(i,t)};g.objects.set(t,f)}for(let r=0,l=t.children.length;r<l;r++)c(t.children[r],e,i)}function w(t,e){return T.setFromMatrixPosition(t.matrixWorld),D.setFromMatrixPosition(e.matrixWorld),T.distanceToSquared(D)}function E(t){const e=[];return t.traverseVisible(function(i){i.isCSS2DObject&&e.push(i)}),e}function d(t){const e=E(t).sort(function(r,l){if(r.renderOrder!==l.renderOrder)return l.renderOrder-r.renderOrder;const f=g.objects.get(r).distanceToCameraSquared,y=g.objects.get(l).distanceToCameraSquared;return f-y}),i=e.length;for(let r=0,l=e.length;r<l;r++)e[r].element.style.zIndex=i-r}}}class lt extends H{constructor(n){super({name:"EleatorShader",uniforms:{contourColor:{value:new _(n==null?void 0:n.color)},contourInterval:{value:n==null?void 0:n.interval},contourWidth:{value:n==null?void 0:n.width}},vertexShader:`
                precision highp float;

                #include <common>
                #include <logdepthbuf_pars_vertex>

                varying float vHeight;

                void main() {
                    #include <begin_vertex>
                    #include <project_vertex>
                    #include <logdepthbuf_vertex>

                    vHeight = position.z;                    
                }
            `,fragmentShader:`
                precision highp float;

                #include <logdepthbuf_pars_fragment>

                uniform vec3 contourColor;
                uniform float contourInterval;
                uniform float contourWidth;
                
                varying float vHeight;

                void main() {
                    #include <logdepthbuf_fragment>

                    float contourPos = mod(vHeight, contourInterval) / contourInterval;
                    float pixelWidth = contourWidth * fwidth(contourPos);  
                    float distToEdge = min(contourPos, 1.0 - contourPos) ; 
                    float edgeFactor = smoothstep(0.0, pixelWidth, distToEdge); 
                    float alpha = smoothstep(0.0, 1.0, 1.0 - edgeFactor);
                    gl_FragColor = vec4(contourColor, alpha);
                }
            `,transparent:!1})}copy(n){return this.uniforms=n.uniforms,this}}class dt extends N{constructor(s=new _(16711680),p=100,h=1){super();L(this,"dataType","contour");this.material=new lt({interval:p,width:h,color:s})}get _uniforms(){return this.material.uniforms}set color(s){this._uniforms.contourColor.value=new _(s)}get color(){return this._uniforms.contourColor.value}set interval(s){this._uniforms.contourInterval.value=s}get interval(){return this._uniforms.contourInterval.value}set width(s){this._uniforms.contourWidth.value=s}get width(){return this._uniforms.contourWidth.value}}const at={class:"demo-container"},ut={class:"tools"},ct={class:"state"},ft={class:"location"},mt={class:"loading"},vt=j({__name:"04",setup(m){const n=new dt(16711680,100,1);q(n);const s=()=>{const d=U.create({imgSource:[new Y,Z.create({dataType:"contour",minLevel:10})],demSource:new J,lon0:90,bounds:[60,0,145,60]});return d.rotateX(-Math.PI/2),d},p=(d,t)=>{const e=d.geo2map(t),i=document.createElement("div");i.className="a4-billboard",i.title=`经纬度: ${t.x.toFixed(2)}, ${t.y.toFixed(2)}`;const r=document.createElement("div");r.className="a4-height",r.textContent=`${t.z.toFixed(1)}米`,i.appendChild(r);const l=new rt(i);l.center.set(.5,1),l.position.copy(e),d.add(l),i.addEventListener("pointerup",()=>{l.removeFromParent()})},h=(d,t,e)=>{const i=new it({element:e}),r=d.renderer.domElement;d.addEventListener("update",()=>{i.render(d.scene,d.camera)}),d.addEventListener("resize",()=>{i.setSize(r.clientWidth,r.clientHeight)});const l=new W;r.addEventListener("pointerdown",f=>{O(f,t,d.camera)&&l.set(f.x,f.y)}),r.addEventListener("pointerup",f=>{const y=O(f,t,d.camera);y&&new W(f.x,f.y).distanceTo(l)<5&&p(t,y)})},C=(d,t,e,i)=>{d.controls.target.copy(t.geo2world(e)),d.camera.position.copy(t.geo2world(i))},x=$(null),g=$(null),v=$(),u=s(),c=new A,w=X(u,c),E=G(u);return K(c.controls,v),tt(()=>{if(!x.value||!g.value){console.error("map or cssrenderer or compass container is null");return}c.addTo(x.value),c.scene.add(u),h(c,u,g.value),Q(c.scene),C(c,u,new S(87,28,5e3),new S(87.03,28.03,8e3)),u.addEventListener("update",()=>{B(u,c.camera)})}),et(()=>{u.dispose()}),(d,t)=>(ot(),nt("div",at,[o("div",{ref_key:"viewerRef",ref:x,class:"map-container"},null,512),o("div",{ref_key:"cssrendererRef",ref:g,class:"cssrenderer"},null,512),o("div",ut,[o("div",null,[t[15]||(t[15]=M(" 等高线颜色： ")),o("button",{class:"button",onClick:t[0]||(t[0]=e=>a(n).color=16711680)},"红色"),o("button",{class:"button",onClick:t[1]||(t[1]=e=>a(n).color=16711935)},"品红色"),o("button",{class:"button",onClick:t[2]||(t[2]=e=>a(n).color=65280)},"绿色"),o("button",{class:"button",onClick:t[3]||(t[3]=e=>a(n).color=255)},"蓝色"),o("button",{class:"button",onClick:t[4]||(t[4]=e=>a(n).color=16776960)},"黄色")]),o("div",null,[t[16]||(t[16]=M(" 等高线间隔： ")),o("button",{class:"button",onClick:t[5]||(t[5]=e=>a(n).interval=10)},"10m"),o("button",{class:"button",onClick:t[6]||(t[6]=e=>a(n).interval=50)},"50m"),o("button",{class:"button",onClick:t[7]||(t[7]=e=>a(n).interval=100)},"100m"),o("button",{class:"button",onClick:t[8]||(t[8]=e=>a(n).interval=300)},"300m"),o("button",{class:"button",onClick:t[9]||(t[9]=e=>a(n).interval=500)},"500m")]),o("div",null,[t[17]||(t[17]=M(" 等高线宽度： ")),o("button",{class:"button",onClick:t[10]||(t[10]=e=>a(n).width=1)},"1px"),o("button",{class:"button",onClick:t[11]||(t[11]=e=>a(n).width=2)},"2px"),o("button",{class:"button",onClick:t[12]||(t[12]=e=>a(n).width=3)},"3px"),o("button",{class:"button",onClick:t[13]||(t[13]=e=>a(n).width=5)},"5px"),o("button",{class:"button",onClick:t[14]||(t[14]=e=>a(n).width=0)},"0px")])]),o("div",{class:"compass",ref_key:"compassRef",ref:v},null,512),o("div",ct,[o("div",ft,[o("span",null,"经度："+k(a(w).x.toFixed(6))+"° ",1),o("span",null,"纬度："+k(a(w).y.toFixed(6))+"° ",1),o("span",null,"海拔："+k(a(w).z.toFixed(1))+"m ",1)]),o("div",mt,k(a(E)),1)])]))}}),Ct=st(vt,[["__scopeId","data-v-c1a05ccb"]]);export{Ct as default};
