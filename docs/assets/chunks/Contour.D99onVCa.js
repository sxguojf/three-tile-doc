var q=Object.defineProperty;var B=(f,o,s)=>o in f?q(f,o,{enumerable:!0,configurable:!0,writable:!0,value:s}):f[o]=s;var R=(f,o,s)=>B(f,typeof o!="symbol"?o+"":o,s);import{d as $,p as E,q as D,v as J,x as Q,c as X,o as Y,j as i,a as w,a4 as L,aa as P,t as C,k as v,ab as Z,_ as G}from"./framework.xbTv8SNN.js";import{d as U,e as O,O as K,V as I,ad as j,C as ee,aO as te,aP as ne,al as oe,as as re,aC as se,ai as ie,aj as le,ak as ae,aQ as de,am as V}from"./index.CqI7X3xo.js";import{a as ue,b as ce,u as fe}from"./style.Ddmk4huO.js";import{u as me}from"./useSky.hmx3ZDdW.js";import{u as pe}from"./useFog.BmDoeG3x.js";class he extends K{constructor(o=document.createElement("div")){super(),this.isCSS2DObject=!0,this.element=o,this.element.style.position="absolute",this.element.style.userSelect="none",this.element.setAttribute("draggable",!1),this.center=new I(.5,.5),this.addEventListener("removed",function(){this.traverse(function(s){s.element instanceof s.element.ownerDocument.defaultView.Element&&s.element.parentNode!==null&&s.element.remove()})})}copy(o,s){return super.copy(o,s),this.element=o.element.cloneNode(!0),this.center=o.center,this}}const M=new O,k=new U,H=new U,A=new O,N=new O;class ve{constructor(o={}){const s=this;let g,x,F,y;const _={objects:new WeakMap},m=o.element!==void 0?o.element:document.createElement("div");m.style.overflow="hidden",this.domElement=m,this.getSize=function(){return{width:g,height:x}},this.render=function(n,r){n.matrixWorldAutoUpdate===!0&&n.updateMatrixWorld(),r.parent===null&&r.matrixWorldAutoUpdate===!0&&r.updateMatrixWorld(),k.copy(r.matrixWorldInverse),H.multiplyMatrices(r.projectionMatrix,k),d(n,n,r),b(n)},this.setSize=function(n,r){g=n,x=r,F=g/2,y=x/2,m.style.width=n+"px",m.style.height=r+"px"};function c(n){n.isCSS2DObject&&(n.element.style.display="none");for(let r=0,l=n.children.length;r<l;r++)c(n.children[r])}function d(n,r,l){if(n.visible===!1){c(n);return}if(n.isCSS2DObject){M.setFromMatrixPosition(n.matrixWorld),M.applyMatrix4(H);const e=M.z>=-1&&M.z<=1&&n.layers.test(l.layers)===!0,t=n.element;t.style.display=e===!0?"":"none",e===!0&&(n.onBeforeRender(s,r,l),t.style.transform="translate("+-100*n.center.x+"%,"+-100*n.center.y+"%)translate("+(M.x*F+F)+"px,"+(-M.y*y+y)+"px)",t.parentNode!==m&&m.appendChild(t),n.onAfterRender(s,r,l));const a={distanceToCameraSquared:W(l,n)};_.objects.set(n,a)}for(let e=0,t=n.children.length;e<t;e++)d(n.children[e],r,l)}function W(n,r){return A.setFromMatrixPosition(n.matrixWorld),N.setFromMatrixPosition(r.matrixWorld),A.distanceToSquared(N)}function T(n){const r=[];return n.traverseVisible(function(l){l.isCSS2DObject&&r.push(l)}),r}function b(n){const r=T(n).sort(function(e,t){if(e.renderOrder!==t.renderOrder)return t.renderOrder-e.renderOrder;const a=_.objects.get(e).distanceToCameraSquared,u=_.objects.get(t).distanceToCameraSquared;return a-u}),l=r.length;for(let e=0,t=r.length;e<t;e++)r[e].element.style.zIndex=l-e}}}class ge extends j{constructor(o){super({name:"EleatorShader",uniforms:{contourColor:{value:new ee(o==null?void 0:o.color)},contourInterval:{value:o==null?void 0:o.interval},contourWidth:{value:o==null?void 0:o.width}},vertexShader:`
                precision highp float;

                #include <common>
                #include <logdepthbuf_pars_vertex>

                varying float vHeight;

                void main() {
                    #include <begin_vertex>
                    #include <project_vertex>
                    #include <logdepthbuf_vertex>

                    vHeight = position.z;                    
                }
            `,fragmentShader:`
                precision highp float;

                #include <logdepthbuf_pars_fragment>

                uniform vec3 contourColor;
                uniform float contourInterval;
                uniform float contourWidth;
                
                varying float vHeight;

                void main() {
                    #include <logdepthbuf_fragment>

                    float contourPos = mod(vHeight, contourInterval) / contourInterval;
                    float pixelWidth = contourWidth * fwidth(contourPos);  
                    float distToEdge = min(contourPos, 1.0 - contourPos) ; 
                    float edgeFactor = smoothstep(0.0, pixelWidth, distToEdge); 
                    float alpha = smoothstep(0.0, 1.0, 1.0 - edgeFactor);
                    gl_FragColor = vec4(contourColor, alpha);
                }
            `,transparent:!1})}copy(o){return this.uniforms=o.uniforms,this}}class xe extends te{constructor(s="#000000",g=100,x=1){super();R(this,"dataType","contour");this.material=new ge({interval:g,width:x,color:s})}get _uniforms(){return this.material.uniforms}set color(s){this._uniforms.contourColor.value.set(s)}get color(){return"#"+this._uniforms.contourColor.value.getHexString()}set interval(s){this._uniforms.contourInterval.value=s}get interval(){return this._uniforms.contourInterval.value}set width(s){this._uniforms.contourWidth.value=s}get width(){return this._uniforms.contourWidth.value}}const ye={class:"demo-container"},_e={class:"tools"},Se={for:"fogFactor"},we={class:"state"},Ce={class:"location"},Ee={class:"loading"},Me=$({__name:"Contour",setup(f){const o=new xe(0,100,1);ne(o);const s=()=>{const e=ie.create({imgSource:[new ae,de.create({dataType:"contour",minLevel:10})],demSource:new le,lon0:90,bounds:[60,0,145,60]});return e.rotateX(-Math.PI/2),e},g=(e,t)=>{const a=e.geo2map(t),u=document.createElement("div");u.className="a4-billboard",u.title=`经纬度: ${t.x.toFixed(2)}, ${t.y.toFixed(2)}`;const p=document.createElement("div");p.className="a4-height",p.textContent=`${t.z.toFixed(1)}米`,u.appendChild(p);const h=new he(u);return h.center.set(.5,1),h.position.copy(a),e.add(h),u.addEventListener("pointerup",()=>{h.removeFromParent()}),h},x=(e,t,a)=>{const u=new ve({element:a}),p=e.renderer.domElement;e.addEventListener("update",()=>{u.render(e.scene,e.camera)}),e.addEventListener("resize",()=>{u.setSize(p.clientWidth,p.clientHeight)});const h=new I;return p.addEventListener("pointerdown",S=>{V(S,t,e.camera)&&h.set(S.x,S.y)}),p.addEventListener("pointerup",S=>{const z=V(S,t,e.camera);z&&new I(S.x,S.y).distanceTo(h)<5&&g(t,z)}),u},F=(e,t,a,u)=>(e.controls.target.copy(t.geo2world(a)),e.camera.position.copy(t.geo2world(u)),{centerPos:e.controls.target,camerePos:e.camera.position}),y=E(null),_=E(null),m=E(),c=s(),d=new oe;d.renderer.toneMapping=re;const W=ue(c,d),T=ce(c),b=E("#000000");D(b,e=>{o.color=e});const n=E(100);D(n,e=>{o.interval=e});const r=E(1);D(r,e=>{o.width=e});const{fogFactor:l}=pe(d);return fe(d.controls,m),J(()=>{if(!y.value||!_.value){console.error("map or cssrenderer or compass container is null");return}d.addTo(y.value),d.scene.add(c),x(d,c,_.value),me(d.scene),F(d,c,new O(87,28,5e3),new O(87.03,28.03,8e3)),c.addEventListener("update",()=>{se(c,d.camera)})}),Q(()=>{c.dispose()}),(e,t)=>(Y(),X("div",ye,[i("div",{ref_key:"viewerRef",ref:y,class:"map-container"},null,512),i("div",{ref_key:"cssrendererRef",ref:_,class:"cssrenderer"},null,512),i("div",_e,[i("label",null,[t[4]||(t[4]=w("等高线颜色 ")),L(i("input",{type:"color","onUpdate:modelValue":t[0]||(t[0]=a=>b.value=a)},null,512),[[P,b.value]])]),i("label",null,[t[5]||(t[5]=w("等高线间隔 ")),L(i("input",{type:"range",min:"100",max:"500",step:"100","onUpdate:modelValue":t[1]||(t[1]=a=>n.value=a)},null,512),[[P,n.value]]),w(" "+C(v(o).interval)+"米 ",1)]),i("label",null,[t[6]||(t[6]=w(" 等高线宽度 ")),L(i("input",{type:"range",min:"0",max:"5",step:"1","onUpdate:modelValue":t[2]||(t[2]=a=>r.value=a)},null,512),[[P,r.value]]),w(" "+C(v(o).width)+"px ",1)]),i("label",Se,[t[7]||(t[7]=w(" 场景雾浓度 ")),L(i("input",{type:"range",id:"fogFactor",min:"0",max:"5",step:"0.1","onUpdate:modelValue":t[3]||(t[3]=a=>Z(l)?l.value=a:null)},null,512),[[P,v(l)]]),w(" "+C(v(l)),1)])]),i("div",{class:"compass",ref_key:"compassRef",ref:m},null,512),i("div",we,[i("div",Ce,[i("span",null,"经度："+C(v(W).x.toFixed(6))+"° ",1),i("span",null,"纬度："+C(v(W).y.toFixed(6))+"° ",1),i("span",null,"海拔："+C(v(W).z.toFixed(1))+"m ",1)]),i("div",Ee,C(v(T)),1)])]))}}),Te=G(Me,[["__scopeId","data-v-0e57eb5f"]]);export{Te as default};
