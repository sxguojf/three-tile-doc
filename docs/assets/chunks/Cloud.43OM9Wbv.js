import{d as E,p as d,q as x,v as V,x as A,c as P,o as k,j as n,F as U,B as T,t as p,a4 as R,a as I,a8 as N,k as h,_ as z}from"./framework.BQo5SrHh.js";import{M as O,ao as $,ap as j,a9 as y,o as F,V as u,ai as q,aq as B,al as G,b as H}from"./index.B0Mz6VAy.js";import{u as W,a as X,b as Y}from"./style.B3RjSc2H.js";class J extends O{constructor(o,a){const r=new $(1,1,o,a);super(r),this.material=this._createMaterial()}_createMaterial(){const o=new j({map:new y,aoMap:new y,displacementMap:new y,transparent:!0,displacementScale:1,displacementBias:0});return o.onBeforeCompile=a=>{a.vertexShader=`uniform sampler2D map;
        `+a.vertexShader,a.vertexShader=a.vertexShader.replace("#include <displacementmap_vertex>",`#include <displacementmap_vertex> 

                #ifdef USE_MAP
                    transformed += normalize( objectNormal) * (texture2D(map, vMapUv).a * displacementScale + displacementBias );
                #endif
                `),a.fragmentShader=a.fragmentShader.replace("#include <alphamap_fragment>",`#include <alphamap_fragment>
                
                #if defined(USE_AOMAP) && defined(USE_MAP)
                    float h = texture2D(map, vMapUv).a;
                    // h = round(h*8.0)/8.0;
                    diffuseColor *= texture2D(aoMap, vec2(h-(20.0/255.0),0.0));
                    diffuseColor.a = clamp(h*1.5, 0.0, 1.0);
                #endif
                `)},this.setPalttle(1),o}async load(o){var r;const a=await new F().loadAsync(o);return(r=this.material.map)==null||r.dispose(),this.material.map=a,a}async setPalttle(o){var m;const a=new F;a.setPath("../../pal/");const r=typeof o=="number"?`pal0${o}.png`:o,_=await a.loadAsync(r);return(m=this.material.aoMap)==null||m.dispose(),this.material.aoMap=_,this}dispose(){var o,a;this.removeFromParent(),this.geometry.dispose(),(o=this.material.aoMap)==null||o.dispose(),(a=this.material.map)==null||a.dispose(),this.material.dispose()}}const K={class:"demo-container"},Q={class:"tools"},Z=["onClick"],ee={for:"wireframe"},ae={class:"state"},te={class:"location"},oe={class:"loading"},se=E({__name:"Cloud",setup(D){const o=()=>{const e=q.create({imgSource:[new B({style:"6"}),new B({style:"8"})],lon0:90,bounds:[60,0,145,60]});return e.rotateX(-Math.PI/2),e.addEventListener("tile-loaded",t=>{t.tile.model.material.forEach(s=>{"color"in s&&s.color.set(11184810)})}),e},a=()=>{const e=new G;return e.scene.background=new H(0),e.scene.fog=null,e.dirLight.intensity=2,e.controls.zoomToCursor=!0,e},r=(e,t)=>{t.controls.maxDistance=5e6;const s=e.geo2world(new u(e.bounds[0],e.bounds[3])),f=e.geo2world(new u(e.bounds[2],e.bounds[1])),g=new u;t.controls.addEventListener("change",function(){g.copy(t.controls.target),t.controls.target.clamp(s,f),g.sub(t.controls.target),t.camera.position.sub(g)})},_=(e,t,s,f)=>{e.controls.target.copy(t.geo2world(s)),e.camera.position.copy(t.geo2world(f))},m=()=>{const e=new J(529,420);return e.scale.set(8e6,7e6,2e5),e.position.set(15e5,4e6,1e3),e.renderOrder=999,e},l=o(),i=a(),c=m(),v=d(null),b=d();W(i.controls,b);const w=X(l,i),L=Y(l),S=d("");x(S,async e=>{await c.load(e)});const C=d(1);x(C,e=>{c.setPalttle(e)});const M=d(!1);return x(M,e=>{c.material.wireframe=e}),V(()=>{if(!v.value){console.error("map or compass container is null");return}i.addTo(v.value),i.scene.add(l),l.add(c),r(l,i),_(i,l,new u(105,35,0),new u(105,25,3e6)),S.value="../../cloud/SATE_L1_F2G_VISSR_MWB_NOM_FDI-202107241900.HDF.png"}),A(()=>{c.dispose(),l.dispose()}),(e,t)=>(k(),P("div",K,[n("div",{ref_key:"viewerRef",ref:v,class:"map-container"},null,512),n("div",Q,[(k(),P(U,null,T([1,2,3,4,5],s=>n("button",{type:"button",class:"button",key:s,onClick:f=>C.value=s}," 调色板"+p(`${s}`),9,Z)),64)),n("label",ee,[R(n("input",{type:"checkbox",name:"wireframe",id:"wireframe","onUpdate:modelValue":t[0]||(t[0]=s=>M.value=s)},null,512),[[N,M.value]]),t[1]||(t[1]=I("线框"))])]),n("div",{class:"compass",ref_key:"compassRef",ref:b},null,512),n("div",ae,[n("div",te,[n("span",null,"经度："+p(h(w).x.toFixed(6))+"° ",1),n("span",null,"纬度："+p(h(w).y.toFixed(6))+"° ",1),n("span",null,"海拔："+p(h(w).z.toFixed(1))+"m ",1)]),n("div",oe,p(h(L)),1)])]))}}),ie=z(se,[["__scopeId","data-v-54af5a03"]]);export{ie as default};
