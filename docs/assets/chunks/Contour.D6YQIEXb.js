var I=Object.defineProperty;var R=(m,n,r)=>n in m?I(m,n,{enumerable:!0,configurable:!0,writable:!0,value:r}):m[n]=r;var _=(m,n,r)=>R(m,typeof n!="symbol"?n+"":n,r);import{l as D,V as S,O as V,h as W,S as A,b as F,aD as H,aE as N,ak as B,aB as q,az as U,ah as J,ai as X,aj as Y,aF as Z,al as O}from"./index.D-Y8yZZR.js";import{a as G,b as K,u as Q}from"./style.RbGHg-Vc.js";import{a as j}from"./useSky.D-YiwE1J.js";import{d as tt,p as M,v as et,x as nt,c as ot,o as rt,j as o,a as $,k as d,t as k,_ as st}from"./framework.CJqd0DOR.js";class it extends V{constructor(n=document.createElement("div")){super(),this.isCSS2DObject=!0,this.element=n,this.element.style.position="absolute",this.element.style.userSelect="none",this.element.setAttribute("draggable",!1),this.center=new W(.5,.5),this.addEventListener("removed",function(){this.traverse(function(r){r.element instanceof r.element.ownerDocument.defaultView.Element&&r.element.parentNode!==null&&r.element.remove()})})}copy(n,r){return super.copy(n,r),this.element=n.element.cloneNode(!0),this.center=n.center,this}}const b=new S,L=new D,z=new D,P=new S,T=new S;class lt{constructor(n={}){const r=this;let v,h,C,x;const g={objects:new WeakMap},p=n.element!==void 0?n.element:document.createElement("div");p.style.overflow="hidden",this.domElement=p,this.getSize=function(){return{width:v,height:h}},this.render=function(t,e){t.matrixWorldAutoUpdate===!0&&t.updateMatrixWorld(),e.parent===null&&e.matrixWorldAutoUpdate===!0&&e.updateMatrixWorld(),L.copy(e.matrixWorldInverse),z.multiplyMatrices(e.projectionMatrix,L),u(t,t,e),l(t)},this.setSize=function(t,e){v=t,h=e,C=v/2,x=h/2,p.style.width=t+"px",p.style.height=e+"px"};function c(t){t.isCSS2DObject&&(t.element.style.display="none");for(let e=0,s=t.children.length;e<s;e++)c(t.children[e])}function u(t,e,s){if(t.visible===!1){c(t);return}if(t.isCSS2DObject){b.setFromMatrixPosition(t.matrixWorld),b.applyMatrix4(z);const i=b.z>=-1&&b.z<=1&&t.layers.test(s.layers)===!0,a=t.element;a.style.display=i===!0?"":"none",i===!0&&(t.onBeforeRender(r,e,s),a.style.transform="translate("+-100*t.center.x+"%,"+-100*t.center.y+"%)translate("+(b.x*C+C)+"px,"+(-b.y*x+x)+"px)",a.parentNode!==p&&p.appendChild(a),t.onAfterRender(r,e,s));const f={distanceToCameraSquared:y(s,t)};g.objects.set(t,f)}for(let i=0,a=t.children.length;i<a;i++)u(t.children[i],e,s)}function y(t,e){return P.setFromMatrixPosition(t.matrixWorld),T.setFromMatrixPosition(e.matrixWorld),P.distanceToSquared(T)}function E(t){const e=[];return t.traverseVisible(function(s){s.isCSS2DObject&&e.push(s)}),e}function l(t){const e=E(t).sort(function(i,a){if(i.renderOrder!==a.renderOrder)return a.renderOrder-i.renderOrder;const f=g.objects.get(i).distanceToCameraSquared,w=g.objects.get(a).distanceToCameraSquared;return f-w}),s=e.length;for(let i=0,a=e.length;i<a;i++)e[i].element.style.zIndex=s-i}}}class at extends A{constructor(n){super({name:"EleatorShader",uniforms:{contourColor:{value:new F(n==null?void 0:n.color)},contourInterval:{value:n==null?void 0:n.interval},contourWidth:{value:n==null?void 0:n.width}},vertexShader:`
                precision highp float;

                #include <common>
                #include <logdepthbuf_pars_vertex>

                varying float vHeight;

                void main() {
                    #include <begin_vertex>
                    #include <project_vertex>
                    #include <logdepthbuf_vertex>

                    vHeight = position.z;                    
                }
            `,fragmentShader:`
                precision highp float;

                #include <logdepthbuf_pars_fragment>

                uniform vec3 contourColor;
                uniform float contourInterval;
                uniform float contourWidth;
                
                varying float vHeight;

                void main() {
                    #include <logdepthbuf_fragment>

                    float contourPos = mod(vHeight, contourInterval) / contourInterval;
                    float pixelWidth = contourWidth * fwidth(contourPos);  
                    float distToEdge = min(contourPos, 1.0 - contourPos) ; 
                    float edgeFactor = smoothstep(0.0, pixelWidth, distToEdge); 
                    float alpha = smoothstep(0.0, 1.0, 1.0 - edgeFactor);
                    gl_FragColor = vec4(contourColor, alpha);
                }
            `,transparent:!1})}copy(n){return this.uniforms=n.uniforms,this}}class dt extends H{constructor(r=new F(16711680),v=100,h=1){super();_(this,"dataType","contour");this.material=new at({interval:v,width:h,color:r})}get _uniforms(){return this.material.uniforms}set color(r){this._uniforms.contourColor.value=new F(r)}get color(){return this._uniforms.contourColor.value}set interval(r){this._uniforms.contourInterval.value=r}get interval(){return this._uniforms.contourInterval.value}set width(r){this._uniforms.contourWidth.value=r}get width(){return this._uniforms.contourWidth.value}}const ut={class:"demo-container"},ct={class:"tools"},ft={class:"state"},mt={class:"location"},pt={class:"loading"},vt=tt({__name:"Contour",setup(m){const n=new dt(16711680,100,1);N(n);const r=()=>{const l=J.create({imgSource:[new Y,Z.create({dataType:"contour",minLevel:10})],demSource:new X,lon0:90,bounds:[60,0,145,60]});return l.rotateX(-Math.PI/2),l},v=(l,t)=>{const e=l.geo2map(t),s=document.createElement("div");s.className="a4-billboard",s.title=`经纬度: ${t.x.toFixed(2)}, ${t.y.toFixed(2)}`;const i=document.createElement("div");i.className="a4-height",i.textContent=`${t.z.toFixed(1)}米`,s.appendChild(i);const a=new it(s);return a.center.set(.5,1),a.position.copy(e),l.add(a),s.addEventListener("pointerup",()=>{a.removeFromParent()}),a},h=(l,t,e)=>{const s=new lt({element:e}),i=l.renderer.domElement;l.addEventListener("update",()=>{s.render(l.scene,l.camera)}),l.addEventListener("resize",()=>{s.setSize(i.clientWidth,i.clientHeight)});const a=new W;return i.addEventListener("pointerdown",f=>{O(f,t,l.camera)&&a.set(f.x,f.y)}),i.addEventListener("pointerup",f=>{const w=O(f,t,l.camera);w&&new W(f.x,f.y).distanceTo(a)<5&&v(t,w)}),s},C=(l,t,e,s)=>(l.controls.target.copy(t.geo2world(e)),l.camera.position.copy(t.geo2world(s)),{centerPos:l.controls.target,camerePos:l.camera.position}),x=M(null),g=M(null),p=M(),c=r(),u=new B;u.renderer.toneMapping=q;const y=G(c,u),E=K(c);return Q(u.controls,p),et(()=>{if(!x.value||!g.value){console.error("map or cssrenderer or compass container is null");return}u.addTo(x.value),u.scene.add(c),h(u,c,g.value),j(u.scene),C(u,c,new S(87,28,5e3),new S(87.03,28.03,8e3)),c.addEventListener("update",()=>{U(c,u.camera)})}),nt(()=>{c.dispose()}),(l,t)=>(rt(),ot("div",ut,[o("div",{ref_key:"viewerRef",ref:x,class:"map-container"},null,512),o("div",{ref_key:"cssrendererRef",ref:g,class:"cssrenderer"},null,512),o("div",ct,[o("div",null,[t[15]||(t[15]=$(" 等高线颜色： ")),o("button",{class:"button",onClick:t[0]||(t[0]=e=>d(n).color=16711680)},"红色"),o("button",{class:"button",onClick:t[1]||(t[1]=e=>d(n).color=16711935)},"品红色"),o("button",{class:"button",onClick:t[2]||(t[2]=e=>d(n).color=65280)},"绿色"),o("button",{class:"button",onClick:t[3]||(t[3]=e=>d(n).color=255)},"蓝色"),o("button",{class:"button",onClick:t[4]||(t[4]=e=>d(n).color=16776960)},"黄色")]),o("div",null,[t[16]||(t[16]=$(" 等高线间隔： ")),o("button",{class:"button",onClick:t[5]||(t[5]=e=>d(n).interval=10)},"10m"),o("button",{class:"button",onClick:t[6]||(t[6]=e=>d(n).interval=50)},"50m"),o("button",{class:"button",onClick:t[7]||(t[7]=e=>d(n).interval=100)},"100m"),o("button",{class:"button",onClick:t[8]||(t[8]=e=>d(n).interval=300)},"300m"),o("button",{class:"button",onClick:t[9]||(t[9]=e=>d(n).interval=500)},"500m")]),o("div",null,[t[17]||(t[17]=$(" 等高线宽度： ")),o("button",{class:"button",onClick:t[10]||(t[10]=e=>d(n).width=1)},"1px"),o("button",{class:"button",onClick:t[11]||(t[11]=e=>d(n).width=2)},"2px"),o("button",{class:"button",onClick:t[12]||(t[12]=e=>d(n).width=3)},"3px"),o("button",{class:"button",onClick:t[13]||(t[13]=e=>d(n).width=5)},"5px"),o("button",{class:"button",onClick:t[14]||(t[14]=e=>d(n).width=0)},"0px")])]),o("div",{class:"compass",ref_key:"compassRef",ref:p},null,512),o("div",ft,[o("div",mt,[o("span",null,"经度："+k(d(y).x.toFixed(6))+"° ",1),o("span",null,"纬度："+k(d(y).y.toFixed(6))+"° ",1),o("span",null,"海拔："+k(d(y).z.toFixed(1))+"m ",1)]),o("div",pt,k(d(E)),1)])]))}}),yt=st(vt,[["__scopeId","data-v-9429cb00"]]);export{yt as default};
